<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>文件夹同步工具 unison 简易指北 - Zee Tsui</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="/favicon.ico">
  <link rel="canonical" href="/posts/2021/20210218-%E6%96%87%E4%BB%B6%E5%A4%B9%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7-unison-%E6%96%87%E4%BB%B6%E5%A4%B9%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7-unison-%E7%AE%80%E6%98%93%E6%8C%87%E5%8C%97/" />

  
  
  <link rel="stylesheet" href="/css/style.min.c813c458db6847576b9bd786addc081f1f218bc0b99cdfe79f2daf35df2e453a.css">
  

  
    
    <meta property="og:title" content="文件夹同步工具 unison 简易指北"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="/posts/2021/20210218-%E6%96%87%E4%BB%B6%E5%A4%B9%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7-unison-%E6%96%87%E4%BB%B6%E5%A4%B9%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7-unison-%E7%AE%80%E6%98%93%E6%8C%87%E5%8C%97/"/>
    
    
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:site" content="@zerostaticio"/>
    <meta name="twitter:creator" content="@zerostaticio"/>
  

  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet"> 
</head>




<body class='page frame page-blog-single'>
  <div id="menu-main-mobile" class="menu-main-mobile">
    <ul class="menu">
        
        
            
                <li class="menu-item-home">
                    <a href="/">Home</a>
                </li>
            
        
            
                <li class="menu-item-blog">
                    <a href="/posts/">Blog</a>
                </li>
            
        
            
                <li class="menu-item-categories">
                    <a href="/categories/">Categories</a>
                </li>
            
        
            
            <li class="menu-item-gallery">
                <a href="/gallery">Gallery</a>
            </li>
            
        
            
                <li class="menu-item-log">
                    <a href="/log/">Log</a>
                </li>
            
        
            
                <li class="menu-item-about">
                    <a href="/pages/about/">About</a>
                </li>
            
        
    </ul>
</div>
  <div id="wrapper" class="wrapper">
    <div class='header'>
  
  <a></a>
  <div class="menu-main">
    <ul>
      
      
      
      <li class="menu-item-home">
        <a href="/">
          
          <span>Home</span>
        </a>
      </li>
      
      
      
      <li class="menu-item-blog">
        <a href="/posts/">
          
          <span>Blog</span>
        </a>
      </li>
      
      
      
      <li class="menu-item-categories">
        <a href="/categories/">
          
          <span>Categories</span>
        </a>
      </li>
      
      
      
      <li class="menu-item-gallery">
        <a href="/gallery">
          
          <span>Gallery</span>
        </a>
      </li>
      
      
      
      <li class="menu-item-log">
        <a href="/log/">
          
          <span>Log</span>
        </a>
      </li>
      
      
      
      <li class="menu-item-about">
        <a href="/pages/about/">
          
          <span>About</span>
        </a>
      </li>
      
      
    </ul>
  </div>
  <div id="toggle-menu-main-mobile" class="hamburger-trigger">
    <button class="hamburger">Menu</button>
  </div>
</div>
    
  <div class="blog">
    <div class="intro-article">
      <h1>文件夹同步工具 unison 简易指北<span class="dot">.</span></h1>
      
    </div>
    <div class="content">
      <p><code>unison</code> 是一款跨 Windows/Linux/MacOS 平台的<strong>双向文件同步工具</strong>，不仅支持本地对本地同步，也支持通过 SSH、RSH 和 Socket 等网络协议进行同步；但需要注意的是，<code>unison</code> 无法实现实时双向同步，仅支持猝发实时同步。</p>
<h2 id="unison-安装"><code>unison</code> 安装</h2>
<h4 id="linux">Linux</h4>
<p>unison 可以直接安装预编译包：<code>sudo apt-get install unison</code></p>
<h4 id="others">Others</h4>
<p>Windows、MacOS 以及其它平台和源码，都能够在<a href="https://github.com/bcpierce00/unison/releases">官方 Github 仓库的 Release</a> 页面下载。</p>
<h2 id="两个文件夹之间双向同步文件">两个文件夹之间双向同步文件</h2>
<p>在两台主机之间进行文件夹同步，需要确保主机都正确安装了 unison，并部署了 ssh 服务。unison 会开启一个监听端口，使用 <code>unison dir1 ssh://username@remotehostname(ip)//absolute/path/to/dir2</code> 结构的命令即可进行文件同步。</p>
<blockquote>
<p><strong>注意</strong>：两个文件夹的顺序是任意的，且只能够在远程和本地、本地和本地之间进行同步，不能够对两台远程机进行操作。</p>
</blockquote>
<p>本地文件夹进行同步，直接使用 <code>unison dir1 dir2</code> 进行同步即可。</p>
<h2 id="unison-的配置选项">unison 的配置选项</h2>
<p>unison 会在用户目录创建一个 <code>.unison</code> 文件夹来保存相关的配置，里面一般会存有 defalut.prf 作为默认配置。在平时可以通过 <code>unison default dir1 dir2</code> 来选择 default 作为配置文件进行同步。除了使用配置文件外，unison 命令还可以接受如下的一些参数：</p>
<ul>
<li><code>-testserver</code> 测试连通性，连接到服务器即退出；如果服务器端 unison 可执行文件不在默认目录下，甚至没有 unison 命令（需要你编译一个上传到服务器），则需要使用 -servercmd 参数告诉要执行的服务器 unison 命令位置。 使用 -testserver 参数，则成功链接即退出，也不会去执行目录的比较等后续操作。</li>
<li><code>-auto</code> 接受缺省的动作，然后等待用户确认是否执行。</li>
<li><code>-batch</code> batch mode, 全自动模式，接受缺省动作，并执行。</li>
<li><code>-ignore xxx</code> 增加 xxx 到忽略列表中</li>
<li><code>-ignorecase [true|false|default]</code> 是否忽略文件名大小写</li>
<li><code>-follow xxx</code> 是否支持对符号连接指向内容的同步； 例如在我的 ~/.unison 的配置文件 default.prf 中有 # Unison preferences file follow = Path {unison_<em>} ignore = Path {WWWROOT/wiki_mirror} ignore = Name {,.}</em>{.~$lock} ignore = Name {a.out} 我将预进行同步的系统文件在 xxx/src 下分别作符号链接，如 unison_httpd.conf 指向 c:/program files/apache/&hellip;/httpd.conf。 同步时，&ldquo;follow = Path {unison_*}&rdquo; 配置（或参数）将跟踪符号链接指向的实际文件。 如果没有该设置，符号链接不予同步。</li>
<li><code>-immutable xxx</code> 不变目录，扫描时即忽略</li>
<li><code>-silent</code> 安静模式</li>
<li><code>-times</code> 同步修改时间</li>
<li><code>-path xxx</code> 参数，只同步</li>
</ul>
<h2 id="需要注意的地方">需要注意的地方</h2>
<h4 id="fat">FAT</h4>
<p>我平常主要使用 <code>unison</code> 进行 WSL 和 Windows 之间的文件同步，而<strong>两者的文件系统是完全不一样的</strong>，所以在 <code>default.prf</code> 中需要添加 <code>fat = true</code> 来保证文件的正确传输，否则会报错提示。</p>
<h4 id="权限问题">权限问题</h4>
<p>在两个文件夹进行同步的时候，可能会出现一边能够正常打开而另一边 <code>Permission Denied</code> 的情况，这是由权限问题所导致的。解决这个问题可以在 <code>default.prf</code> 中添加 <code>perms = -1</code>，从而保证两边都能够正常打开和使用文件。</p>

    </div>
    
    <link href="https://cdn.bootcss.com/KaTeX/0.10.2/katex.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/KaTeX/0.10.2/katex.min.js"></script>
    <script src="https://cdn.bootcss.com/KaTeX/0.10.2/contrib/auto-render.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
          renderMathInElement(document.body, {
                  delimiters: [
                      {left: "$$", right: "$$", display: true},
                      {left: "$", right: "$", display: false}
                  ]
              });
        });
    </script>
  </div>

    <div class="footer">
  <div class="footer-social">
    <h1></h1>
    <p>Copyright © 2022 All Rights Reserved. Built by Zee with ❤.</p>
  </div>
</div>
  </div>

  

  

  
  <script type="text/javascript" src="/js/bundle.min.5993fcb11c07dea925a3fbd58c03c7f1857197c35fccce3aa963a12c0b3c9960.js"></script>
  

  
  

</body>
</html>